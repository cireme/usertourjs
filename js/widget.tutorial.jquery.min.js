(function(e){function t(t){e(t.options.elementContainer).append(['<div id="tutorial-intro" class="window">','<div id="intro-title">',t.options.intro.title,"</div>",'<div id="intro-text">',t.options.intro.text,"</div>",'<div id="intro-btn">','<button id="intro-accept" class="btn">',t.options.intro.acceptText,"</button>",'<button id="intro-refuse" class="btn">',t.options.intro.refuseText,"</button>","</div>","</div>"].join(""));e("#tutorial-intro").css({"z-index":"6000"}).center().show();e(window).resize(function(){e("#tutorial-intro").center()});e("#overlay").css("opacity","0.1");b(t)}function n(t){e("#tutorial-intro").remove();if(t){e("#overlay").remove()}}function r(t){var n=t.options.currentStep;var r=t.options.steps[n];e(r.identifier).attr("title","#");e(t.options.elementContainer).append(['<div class="tutorial-tooltip">',i(r,t),"</div>"].join(""));var s=e(r.identifier).offset().left;var o=e(r.identifier).offset().top;var u=e(r.identifier).innerHeight();var a=e(r.identifier).innerWidth();v(o,s,u,a,t);y(t);g(t);e(window).resize(function(){y(t)});E(t);e("html,body").animate({scrollTop:e(t.options.id).offset().top},"slow")}function i(e,t){return['<div class="tutorial-title">',T(e.title),"</div>",'<div class="tutorial-description">',T(e.text),"</div>",o(t)].join("")}function s(t){var n=t.options.elementContainer;var r=n=="body"?"100%":n.height();var i=n=="body"?"100%":n.width();var s=t.options.steps[t.options.currentStep];e(n).append("<div id='overlay'></div>");e("#overlay").height(r).width(i).css({position:"fixed",top:0,left:0,"z-index":5e3,"background-color":"#fff",opacity:0});e(window).resize(function(){e("#overlay").height(e(n).height()).width(e(n).width()).position({of:e(n)})})}function o(e){return['<div class="tutorial-btn-container">',f(e),a(e),u(e),"</div>"].join("")}function u(e){var t;if(e.options.steps.length-1==e.options.currentStep){if(e.options.completeHref!=""){t=e.options.completeBtnText}else{t=e.options.endBtnText}}else{t=e.options.nextBtnText}return['<button class="tutorial-next">',T(t),"</button>"].join("")}function a(e){if(e.options.currentStep==0){if(e.options.prevHref!=""){return['<button class="tutorial-previous">',T(e.options.prevRedirectBtn),"</button>"].join("")}return}return['<button class="tutorial-previous">',T(e.options.prevBtnText),"</button>"].join("")}function f(e){if(e.options.currentStep==e.options.steps.length-1&&e.options.completeHref==""){return}return['<button class="tutorial-exit">',T(e.options.exitBtnText),"</button>"].join("")}function l(t){if(t.options.last){t._trigger("complete")}if(t.options.completeHref!=undefined&&t.options.completeHref!=""){document.location.href=t.options.completeHref;return false}e("#overlay").remove();c(t);m()}function c(t){e(t.options.id).remove();S(t)}function h(e){if(e.options.steps.length-1==e.options.currentStep){l(e);e.options.currentStep++;return false}c(e);m();e.options.currentStep++}function p(e){if(e.options.currentStep==0&&e.options.prevHref!=""){document.location.href=e.options.prevHref;return false}c(e);m();e.options.currentStep--}function d(t){e("#overlay").remove();c(t);m();if(t.options.exitHref!=undefined&&t.options.exitHref!=""){document.location.href=t.options.exitHref}return false}function v(t,n,r,i,s){var o=s.options.currentStep;var u=s.options.steps[o];var a=s.options.borderSize;var f=e(u.identifier).offset().left;var l=e(u.identifier).offset().top;var c=e("<div/>").attr("id","bordered-tutorial").css({height:r,width:i,border:a+"px solid #"+s.options.borderColor,"z-index":5010,position:"absolute",top:l,left:f});e("body").append(c);e(window).resize(function(){c.height(e(u.identifier).height()).width(e(u.identifier).width()).position({of:e(u.identifier)})})}function m(){e("#bordered-tutorial").remove()}function g(t){var n=t.options.steps[t.options.currentStep];$arrow=e("<div/>").addClass("arrow");if(n.position=="top"){$arrow.addClass("b");e(t.options.id).append($arrow)}if(n.position=="bottom"){$arrow.addClass("t");e(t.options.id).append($arrow)}if(n.position=="left"){$arrow.addClass("r");e(t.options.id).append($arrow)}if(n.position=="right"){$arrow.addClass("l");e(t.options.id).append($arrow)}}function y(t){var n=t.options.currentStep;var r=t.options.steps[n];var i=e(r.identifier).offset().left;var s=e(r.identifier).offset().top;var o=e(r.identifier).innerHeight();var u=e(r.identifier).innerWidth();var a=0;var f=0;var l=t.options.borderSize-1;var c=e(t.options.id).height();var h=e(t.options.id).width();var r=t.options.steps[t.options.currentStep];if(r.position=="top"){f=s-(c+28+l);a=i}if(r.position=="bottom"){f=s+o+10+l;a=i}if(r.position=="left"){f=s;a=i-(h+l+28)}if(r.position=="right"){f=s;a=i+u+10+l}e(t.options.id).css({left:a,top:f})}function b(t){e(t.options.elementContainer).delegate("#intro-accept","click",function(){t.intro_accept()});e(t.options.elementContainer).delegate("#intro-refuse","click",function(){t.intro_refuse()})}function w(t){e(t.options.elementContainer).undelegate("#intro-accept","click");e(t.options.elementContainer).undelegate("#intro-refuse","click")}function E(t){e(t.options.elementContainer).delegate(".tutorial-next","click",function(){t.next()});if(t.options.currentStep!=0||t.options.prevHref!=""){e(t.options.elementContainer).delegate(".tutorial-previous","click",function(){t.prev()})}e(t.options.elementContainer).delegate(".tutorial-exit","click",function(){t.exit()});e(document).delegate("body","keydown",function(e){if(e.keyCode==39||e.keyCode==13){e.preventDefault();t.next();return false}if(e.keyCode==27){e.preventDefault();t.exit();return false}if(t.options.currentStep!=0||t.options.prevHref!=""){if(e.keyCode==37){e.preventDefault();t.prev();return false}}})}function S(t){e(t.options.elementContainer).undelegate(".tutorial-next","click");e(t.options.elementContainer).undelegate(".tutorial-previous","click");e(t.options.elementContainer).undelegate(".tutorial-exit","click");e(document).undelegate("body","keydown");e(window).off("resize")}function T(e){x.innerHTML=e;return x.innerHTML}e.widget("nt.tutorial",{widgetEventPrefix:"tutorial",options:{id:".tutorial-tooltip",steps:[],intro:{launch:false,text:"test",title:"titre",acceptText:"Launch",refuseText:"Close"},elementContainer:"body",currentStep:0,prevHref:"",prevRedirectBtn:"",completeHref:"",completeBtnText:"Continue",exitBtnText:"Exit",nextBtnText:"Next",prevBtnText:"Previous",endBtnText:"The end",borderColor:"004ECC",borderSize:1,last:false},_create:function(){this._setOptions({steps:this.options.steps,elementContainer:this.element,currentStep:this.options.currentStep,completeHref:this.options.completeHref,completeBtnText:this.options.completeBtnText,exitBtnText:this.options.exitBtnText,nextBtnText:this.options.nextBtnText,prevBtnText:this.options.prevBtnText,endBtnText:this.options.endBtnText,borderColor:this.options.borderColor})},_destroy:function(){d(this)},start:function(e){this._setOption("currentStep",typeof e!=="undefined"?e:0);s(this);var t=this.options.intro;if(t.launch){this.intro()}else{this.show()}},intro:function(){t(this)},intro_accept:function(){n(false);this.show()},intro_refuse:function(){this._trigger("beforeclose");n(true)},setStep:function(e,t){this.options.steps[t]=e},removeStep:function(e){this.options.steps.splice(e,1)},getCurrentStep:function(){return this.options.currentStep},next:function(){this._trigger("beforenext");h(this);if(this.options.steps.length!=this.options.currentStep){this.show();this._trigger("afternext")}else{this._trigger("end")}},prev:function(){this._trigger("beforeprev");p(this);this.show();this._trigger("afterprev")},show:function(){this._trigger("beforeshow");var e=this;setTimeout(function(){r(e)},500);this._trigger("aftershow")},exit:function(){this._trigger("exit");d(this)}});var x=document.createElement("textarea");e.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,(e(window).height()-e(this).outerHeight())/2+e(window).scrollTop())+"px");this.css("left",Math.max(0,(e(window).width()-e(this).outerWidth())/2+e(window).scrollLeft())+"px");return this}})(jQuery);