(function($){var toolTipCount=0;$.widget('nt.tutorial',{widgetEventPrefix:"tutorial",options:{steps:[],intro:{launch:false,text:"test",title:"titre",acceptText:"Launch",refuseText:"Close"},elementContainer:"body",currentStep:0,prevHref:"",prevRedirectBtn:"",completeHref:"",completeBtnText:"Continue",exitBtnText:"Exit",nextBtnText:"Next",prevBtnText:"Previous",endBtnText:"The end",borderColor:"FF0000",borderSize:1,last:false},_create:function(){this._setOptions({'steps':this.options.steps,'elementContainer':this.element,'currentStep':this.options.currentStep,'completeHref':this.options.completeHref,'completeBtnText':this.options.completeBtnText,'exitBtnText':this.options.exitBtnText,'nextBtnText':this.options.nextBtnText,'prevBtnText':this.options.prevBtnText,'endBtnText':this.options.endBtnText,'borderColor':this.options.borderColor})},_destroy:function(){exitPressed(this)},start:function(step){this._setOption('currentStep',(typeof step!=="undefined")?step:0);createOverlay(this);var intro=this.options.intro;if(intro.launch){this.intro()}else{this.show()}},intro:function(){showIntro(this)},intro_accept:function(){closeIntro(false);this.show()},intro_refuse:function(){this._trigger("beforeclose");closeIntro(true)},setStep:function(step,index){this.options.steps[index]=step},getCurrentStep:function(){return this.options.currentStep},next:function(){this._trigger("beforenext");nextPressed(this);if(this.options.steps.length!=(this.options.currentStep)){this.show();this._trigger("afternext")}},prev:function(){this._trigger("beforeprev");previousPressed(this);this.show();this._trigger("afterprev")},show:function(){this._trigger("beforeshow");var widget=this;setTimeout(function(){showStep(widget)},500);this._trigger("aftershow")},exit:function(){this._trigger("exit");exitPressed(this)}});function showIntro(widget){$(widget.options.elementContainer).append(['<div id="tutorial-intro" class="window">','<div id="intro-title">',widget.options.intro.title,'</div>','<div id="intro-text">',widget.options.intro.text,'</div>','<div id="intro-btn">','<button id="intro-accept" class="btn">',widget.options.intro.acceptText,'</button>','<button id="intro-refuse" class="btn">',widget.options.intro.refuseText,'</button>','</div>','</div>'].join(''));$("#tutorial-intro").css({'z-index':'6000'}).center().show();$("#overlay").css("opacity","0.1");delegateIntroEvent(widget)}function closeIntro(closeOverlay){$("#tutorial-intro").remove();if(closeOverlay){$("#overlay").remove()}}function showStep(widget){var currentStep=widget.options.currentStep;var step=widget.options.steps[currentStep];$(step.identifier).attr('title','#');$(widget.options.elementContainer).append(['<div class="tutorial-tooltip">',createTooltipContent(step,widget),'</div>'].join(''));var x=$(step.identifier).offset().left;var y=$(step.identifier).offset().top;var height=$(step.identifier).innerHeight();var width=$(step.identifier).innerWidth();var position=handlePosition(x,y,height,width,widget);addBorderedDiv(y,x,height,width,widget);$(".tutorial-tooltip").css({left:position.x,top:position.y});delegateEvents(widget)}function createTooltipContent(step,widget){return['<div class="tutorial-title">',escapeHTML(step.title),'</div>','<div class="tutorial-description">',escapeHTML(step.text),'</div>',createBtnContainer(widget)].join('')}function createOverlay(widget){var container=widget.options.elementContainer;var elementHeight=(container=="body")?'100%':container.height();var elementWidth=(container=="body")?'100%':container.width();var step=widget.options.steps[widget.options.currentStep];$(container).append("<div id='overlay'></div>");$("#overlay").height(elementHeight).width(elementWidth).css({'position':'fixed','top':0,'left':0,'z-index':5000,'background-color':'#fff','opacity':0});$(window).resize(function(){$('#overlay').height($(container).height()).width($(container).width()).position({of:$(container)});$('#bordered-tutorial').height($(step.identifier).height()).width($(step.identifier).width()).position({of:$(step.identifier)})})}function delegateResize(container,highlight){$(window).resize(function(){$('#overlay').height($(container).height()).width($(container).width()).position({of:$(container)});$('#bordered-tutorial').height($(highlight).height()).width($(highlight).width()).position({of:$(highlight)})})}function undelegateResize(){}function createBtnContainer(widget){return['<div class="tutorial-btn-container">',createExitBtn(widget),createPreviousBtn(widget),createNextBtn(widget),'</div>'].join('')}function createNextBtn(widget){var btnText;if(widget.options.steps.length-1==widget.options.currentStep){if(widget.options.completeHref!=""){btnText=widget.options.completeBtnText}else{btnText=widget.options.endBtnText}}else{btnText=widget.options.nextBtnText}return['<button class="tutorial-next">',escapeHTML(btnText),'</button>'].join('')}function createPreviousBtn(widget){if(widget.options.currentStep==0){if(widget.options.prevHref!=""){return['<button class="tutorial-previous">',escapeHTML(widget.options.prevRedirectBtn),'</button>'].join('')}return}return['<button class="tutorial-previous">',escapeHTML(widget.options.prevBtnText),'</button>'].join('')}function createExitBtn(widget){if(widget.options.currentStep==widget.options.steps.length-1&&widget.options.completeHref==""){return}return['<button class="tutorial-exit">',escapeHTML(widget.options.exitBtnText),'</button>'].join('')}function onComplete(widget){if(widget.options.last){widget._trigger("complete")}if(widget.options.completeHref!=undefined&&widget.options.completeHref!=""){document.location.href=widget.options.completeHref;return false}$("#overlay").remove();hideCurrentStep(widget);removeBorderedDiv()}function hideCurrentStep(widget){$(".tutorial-tooltip").remove();undelegateEvents(widget)}function nextPressed(widget){if(widget.options.steps.length-1==widget.options.currentStep){onComplete(widget);widget.options.currentStep++;return false}hideCurrentStep(widget);removeBorderedDiv();widget.options.currentStep++}function previousPressed(widget){if(widget.options.currentStep==0&&widget.options.prevHref!=""){document.location.href=widget.options.prevHref;return false}hideCurrentStep(widget);removeBorderedDiv();widget.options.currentStep--}function exitPressed(widget){$("#overlay").remove();hideCurrentStep(widget);removeBorderedDiv();if(widget.options.exitHref!=undefined&&widget.options.exitHref!=""){document.location.href=widget.options.exitHref}return false}function addBorderedDiv(top,left,height,width,widget){var currentStep=widget.options.currentStep;var borderSize=widget.options.borderSize;var $divBordered=$("<div/>").attr('id','bordered-tutorial').position({of:$(widget.options.steps[currentStep].identifier),at:"left-"+(borderSize-1)+" top-"+(borderSize-1)}).css({'height':height,'width':width,"border":borderSize+"px solid #"+widget.options.borderColor,'z-index':5010,'position':'absolute'});$("body").append($divBordered)}function removeBorderedDiv(){$("#bordered-tutorial").remove()}function handlePosition(x,y,height,width,widget){var xPos=0;var yPos=0;var tooltipId="#ui-tooltip-"+toolTipCount;var borderDiff=widget.options.borderSize-1;var tooltipHeight=$(".tutorial-tooltip").height();var tooltipWidth=$(".tutorial-tooltip").width();var step=widget.options.steps[widget.options.currentStep];$arrow=$("<div/>").addClass('arrow');if(step.position=="top"){yPos=(y-(tooltipHeight+25+borderDiff));xPos=x;$arrow.addClass('b');$(".tutorial-tooltip").append($arrow)}if(step.position=="bottom"){yPos=(y+height+10+borderDiff);xPos=x;$arrow.addClass('t');$(".tutorial-tooltip").append($arrow)}if(step.position=="left"){yPos=y;xPos=(x-(tooltipWidth+borderDiff+25));$arrow.addClass('r');$(".tutorial-tooltip").append($arrow)}if(step.position=="right"){yPos=y;xPos=(x+width+10+borderDiff);$arrow.addClass('l');$(".tutorial-tooltip").append($arrow)}return{x:xPos,y:yPos}}function delegateIntroEvent(widget){$(widget.options.elementContainer).delegate('#intro-accept','click',function(){widget.intro_accept()});$(widget.options.elementContainer).delegate('#intro-refuse','click',function(){widget.intro_refuse()})}function undelegateIntroEvents(widget){$(widget.options.elementContainer).undelegate('#intro-accept','click');$(widget.options.elementContainer).undelegate('#intro-refuse','click')}function delegateEvents(widget){$(widget.options.elementContainer).delegate('.tutorial-next','click',function(){widget.next()});if(widget.options.currentStep!=0||widget.options.prevHref!=""){$(widget.options.elementContainer).delegate('.tutorial-previous','click',function(){widget.prev()})}$(widget.options.elementContainer).delegate('.tutorial-exit','click',function(){widget.exit()});$(document).delegate("body","keydown",function(e){if(e.keyCode==39||e.keyCode==13){e.preventDefault();widget.next();return false}if(e.keyCode==27){e.preventDefault();widget.exit();return false}if(widget.options.currentStep!=0||widget.options.prevHref!=""){if(e.keyCode==37){e.preventDefault();widget.prev();return false}}})}function undelegateEvents(widget){$(widget.options.elementContainer).undelegate('.tutorial-next','click');$(widget.options.elementContainer).undelegate('.tutorial-previous','click');$(widget.options.elementContainer).undelegate('.tutorial-exit','click');$(document).undelegate("body","keydown");$(window).off("resize")}var escape=document.createElement('textarea');function escapeHTML(html){escape.innerHTML=html;return escape.innerHTML}$.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,(($(window).height()-$(this).outerHeight())/2)+$(window).scrollTop())+"px");this.css("left",Math.max(0,(($(window).width()-$(this).outerWidth())/2)+$(window).scrollLeft())+"px");return this}})(jQuery);